{"version":3,"file":"pages/listen_detail/listen_detail.js","sources":["webpack:///./src/pages/listen_detail/listen_detail.jsx","webpack:///./src/pages/listen_detail/listen_detail.jsx?193f","webpack:///./src/pages/listen_detail/style.scss"],"sourcesContent":["import { View, Image, Text } from '@tarojs/components'\r\nimport { useRouter } from '@tarojs/taro'\r\nimport { useEffect, useState } from 'react'\r\nimport {\r\n\tfetchBookDetail,\r\n\tfetchAddStar,\r\n\tfetchAddComment\r\n} from '@/utils/api'\r\nimport {\r\n\tQfAudio,\r\n\tQfCommentBar,\r\n\tQfTabSwiper\r\n} from '@/components'\r\nimport './style.scss'\r\n\r\nconst BookInfo = props => {\r\n\tconst { info } = props\r\n\treturn (\r\n\t\t<View className='info'>\r\n\t\t\t<Image src={'http://localhost:8888'+info.img} />\r\n\t\t\t<View className='desc'>{info.desc}</View>\r\n\t\t\t<View className='name'>{info.book_name}</View>\r\n\t\t</View>\r\n\t)\r\n}\r\n\r\nconst CommentRow = props => {\r\n\tconst { comment } = props\r\n\tconsole.log('comment', comment)\r\n\treturn (\r\n\t\t<View className='comment-row'>\r\n\t\t\t<View className='left'>\r\n\t\t\t\t<Image src={comment.avatar} />\r\n\t\t\t</View>\r\n\t\t\t<View className='right'>\r\n\t\t\t\t<View>\r\n\t\t\t\t\t<Text>{comment.nick_name||'gp5'}</Text>\r\n\t\t\t\t\t<Text>{comment.comment_time}</Text>\r\n\t\t\t\t</View>\r\n\t\t\t\t<View>{comment.content}</View>\r\n\t\t\t</View>\r\n\t\t</View>\r\n\t)\r\n}\r\n\r\nconst StarRow = props => {\r\n\tconst { star } = props\r\n\treturn (\r\n\t\t<View className='star-row'>\r\n\t\t\t<Image src={star.avatar} />\r\n\t\t\t<Text>{star.nick_name}</Text>\r\n\t\t</View>\r\n\t)\r\n}\r\n\r\nexport default props => {\r\n\r\n\tconst [book, setBook] = useState({})\r\n\tconst [commentList, setCommentList] = useState([])\r\n\tconst [actived, setActived] = useState(false)\r\n\tconst [count, setCount] = useState(0)\r\n\tconst [tabArr, setTabArr] = useState([\r\n  \t{ id: 0, label: '评论', count: 0, height: 140 },\r\n  \t{ id: 1, label: '点赞', count: 0, height: 100 }\r\n  ])\r\n\r\n\tconst router = useRouter()\r\n\tuseEffect(()=>{\r\n\t\tconst id = router.params.id\r\n\t\tfetchBookDetail({bookid:id}).then(res=>{\r\n\t\t\tsetBook(res.book)\r\n\t\t\tsetCommentList(res.commentList)\r\n\t\t})\r\n\t}, [count])\r\n\r\n\tuseEffect(()=>{\r\n\t\t// 动态修改tabArr中的count字段\r\n\t\tconst newTabArr = JSON.parse(JSON.stringify(tabArr))\r\n\t\tnewTabArr[0].count = commentList.length\r\n\t\tnewTabArr[1].count = (book.star_list ? book.star_list.length : 0)\r\n\t\tsetTabArr(newTabArr)\r\n\t}, [book, commentList])\r\n\r\n\tconst activedHandle = ()=> {\r\n    setActived(true)\r\n  }\r\n\t// 提交评论接口\r\n  const submitHandle = (e)=> {\r\n    // 激活状态点击发表评论\r\n\t\tconsole.log('评论内容', e)\r\n\t\t// 提交接口成功后\r\n\t\tconst data = {\r\n\t\t\tbookid: router.params.id,\r\n\t\t\tcontent: e\r\n\t\t}\r\n\t\tfetchAddComment(data).then(()=>{\r\n\t\t\tsetActived(false)\r\n\t\t\tsetCount(count+1)\r\n\t\t})\r\n  }\r\n\t// 提交点赞接口\r\n  const starHandle = ()=> {\r\n    // 在非激活状态下点赞\r\n    // 提交接口\r\n\t\tif(!book.is_star) {\r\n\t\t\tconst id = router.params.id\r\n\t\t\tfetchAddStar({bookid: id}).then(()=>{\r\n\t\t\t\tsetCount(count+1)\r\n\t\t\t})\r\n\t\t}\r\n  }\r\n\r\n\r\n\treturn (\r\n\t\t<View className='qf-listen-detail'>\r\n\r\n\t\t\t<BookInfo info={book} />\r\n\r\n\t\t\t<QfAudio data={book} />\r\n\r\n\t\t\t<QfTabSwiper tabArr={tabArr}>\r\n\t\t\t\t<View>\r\n\t\t\t\t\t{commentList.map(ele=>(<CommentRow key={ele._id} comment={ele} />))}\r\n\t\t\t\t</View>\r\n\t\t\t\t<View>\r\n\t\t\t\t\t{book.star_list && book.star_list.map(ele=>(<StarRow key={ele._id} star={ele} />))}\r\n\t\t\t\t</View>\r\n\t\t\t</QfTabSwiper>\r\n\r\n\t\t\t<QfCommentBar\r\n\t\t\t\tactived={actived}\r\n\t\t\t\tcommentCount={commentList.length}\r\n\t\t\t\tisStar={book.is_star}\r\n\t\t\t\tstarCount={book.star_list ? book.star_list.length : 0}\r\n\t\t\t\tonActived={activedHandle}\r\n\t\t\t\tonSubmit={e=>submitHandle(e)}\r\n\t\t\t\tonAgree={starHandle}\r\n\t\t\t/>\r\n\t\t</View>\r\n\t)\r\n}\r\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!./listen_detail.jsx\"\nvar config = {\"navigationBarTitleText\":\"详情\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/listen_detail/listen_detail', {root:{cn:[]}}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAKA;AAKA;;;;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAHA;AAHA;AACA;AAUA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AADA;AAGA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAFA;AAIA;AAAA;AALA;AAJA;AAJA;AACA;AAkBA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAFA;AAHA;AACA;AASA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAFA;AAFA;AAQA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAOA;AACA;AA7BA;AACA;AACA;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAxCA;AACA;AACA;AA4CA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AARA;AACA;AAWA;AACA;AAAA;AAEA;AAAA;AAEA;AAAA;AAEA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AADA;AAGA;AACA;AAAA;AAAA;AAAA;AADA;AAJA;AAUA;AACA;AACA;AACA;AACA;AACA;AAAA;AANA;AAOA;AAPA;AAfA;AA3DA;;;;;;;;;;;;;ACvDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}